<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> [study] Vector Quantization | Joel Lee </title> <meta name="author" content="Joel Lee"> <meta name="description" content="Vector Quantization"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://joonhyung-lee.github.io//blog/2023/vq/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?bf50d6d9dd867d3e0f3b0add94449649"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Joel Lee </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">miscellaneous </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/repositories/">repositories</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/teaching/">teaching</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/gallery/">gallery</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">[study] Vector Quantization</h1> <p class="post-meta"> October 23, 2023 </p> <p class="post-tags"> <a href="/blog/2023"> <i class="fa-solid fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/tag/machine-learning"> <i class="fa-solid fa-hashtag fa-sm"></i> Machine Learning</a>     ·   <a href="/blog/category/study"> <i class="fa-solid fa-tag fa-sm"></i> study</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <h3 id="1-vector-quantization-vq">1. Vector quantization (VQ)</h3> <h4 id="11-in-what-applications-is-vq-used">1.1. In what applications is VQ used?</h4> <p>Vector quantization is used in many applications such as image and voice compression, voice recognition (in general statistical pattern recognition), and surprisingly enough in volume rendering.</p> <h4 id="12-definition-what-is-vq">1.2. Definition: What is VQ?</h4> <p>A vector quantizer maps k-dimensional vectors in the vector space \(\mathbb{R}^{k}\) into a finite set of vectors \(Y = \{y_{i}: i = 1, 2, \cdots, N\}\). Each vector \(y_{i}\) is called a <strong>code vector</strong> or a <strong>codeword</strong>. and the set of all the codewords is called a <strong>codebook</strong>. Associated with each codeword, \(y_{i}\), is a nearest neighbor region called <strong><code class="language-plaintext highlighter-rouge">Voronoi region</code></strong>, and it is defined by:</p> <p>Suppose you have recorded sounds at different locations and want to categorize them into similar groups. In other words, you have a stochastic vector \(x\) which you want to characterize with a simple description. For example, categories could correspond to \(\textbf{office, street, hallway}\) and \(\textbf{cafeteria}\).</p> <p>A classic way for this task is to choose <strong>template vectors</strong> \(\mathbf{c_{k}}\), which represents a typical sound in each environment \(\mathbf{k}\). To categorize the sounds, you then find that <strong>template vector</strong> which is closest to your recording \(\mathbf{x}\). In mathematical notation, you search for a \(\mathbf{ k^{^*} }\) by</p> \[\mathbf{k^*} = \arg\min_{\mathbf{k}} \|x-c_{\mathbf{k} }\|^2.\] <p>The above expression thus calculates the squared error between \(x\) and each of the vectors \(c_{\mathbf{k}}\) and chooses the index \(\mathbf{k}\) of the vector with the smallest error. The vectors \(c_{\mathbf{k}}\) then represent a codebook and the vector \(x\) is quantized to \(c_{\mathbf{k}^*}\). This is the basic idea behind <em>vector quantization,</em> which is also known as \(\mathbf{k}\)<strong>-means</strong>.</p> <div align="center"> <img src="/assets/img/vq/vq-gaussian.png" width="75%"> <p>Fig. 1: Example of a codebook for a 2D Gaussian with 16 code vectors.</p> </div> <p>A illustration of a simple vector codebook is shown on the above. The input data is a Gaussian distribution shown with grey dots and the codebook vectors \(c_{\mathbf{k}}\) with red circles. For each input vector we thus search for the nearest codebook vector and the borders of the regions where input vectors are assigned to a particular codebook vector are illustrated with blue lines. These regions are known as <a href="https://en.wikipedia.org/wiki/Voronoi_diagram" rel="external nofollow noopener" target="_blank">Voronoi regions</a> and the blue lines are the decision-boundaries between codebook vectors.</p> <h4 id="13-metric-for-codebook-quality">1.3. Metric for codebook quality</h4> <p>Suppose then that you have a large collection of vectors \(x_{h}\), and <strong>you want to find out how well this codebook represents the input data.</strong> The expectation of the squared error is approximately the mean over your data, such that</p> \[E_h\left[ \min_\mathbf{k} \|x_h-c_\mathbf{k}\|^2 \right] \approx \frac 1N \sum_{h=1}^N \min_\mathbf{k} \|x_h-c_\mathbf{k}\|^2,\] <p>where \(E[\cdot]\) is the expectation operator and \(N\) is the number of input vectors \(x_{h}\). <strong>Above, we thus find the codebook vector which is closest to \(x_{h}\),</strong> find its squared error and take the expectation over all possible inputs. This is approximately equal to the mean of those squared errors over a set of input vectors. To find the best set of codebook vectors \(c_{k}\), we then need to minimize the mean squared error as</p> \[\{c_\mathbf{k}^*\} := \arg\min_{\{c_\mathbf{k}\}}\, E_h\left[ \min_\mathbf{k} \|x_h-c_\mathbf{k}\|^2 \right]\] <p>or more specifically, for a dataset as</p> \[\{c_\mathbf{k}^*\} := \arg\min_{\{c_\mathbf{k}\}} \sum_{h=1}^N \min_\mathbf{k} \|x_h-c_\mathbf{k}\|^2.\] <p>Unfortunately we do not have an analytic solution for this optimization problem, but have to use numerical, iterative methods.</p> <h3 id="2-codebook-optimization">2. Codebook optimization</h3> <h4 id="21-expectation-maximization-em">2.1. Expectation maximization (EM)</h4> <p>Classical methods for finding the best codebook are derivatives of <code class="language-plaintext highlighter-rouge">expectation maximization (EM)</code>, which is based on two alternating steps:</p> <p><strong>Expectation Maximation (EM)</strong> algorithm:</p> <ol> <li>For every vector \(x_{h}\) in a large database, find the best codebook vector \(c_{\mathbf{k}}\).</li> <li>For every codebook vector \(c_{\mathbf{k}}\); <ol> <li>Find all vectors \(x_{h}\) assigned to that codevector.</li> <li>Calculate mean of those vectors.</li> <li>Assign the mean as a new value for the codevector.</li> </ol> </li> <li>If converged then stop, otherwise go to 1.</li> </ol> <p>This algorithm is guaranteed to give a codebook at every step which is <strong>not worse</strong> than the previous codebook. That is, at each iteration will improve until it finds a local minimum, where it stops changing. The reason is that each step in the iteration finds a partial best-solution.</p> <ul> <li>In the first step, we find the best matching codebook vectors for each data vectors \(x_{h}\).</li> <li>In the second step, we find the within-category mean. <ul> <li>That is, the new mean is more accurate than the previous codevector in that it reduces the average squared error. If the mean is equal to the previous codevector, then there is no improvement.</li> </ul> </li> </ul> <p>As noted above, this algorithm is the basis to most vector quantization codebook optimization algorithms. There are a multiple reasons why this simple algorithm is usually not sufficient alone. Most importantly, the above algorithm is <strong>slow to converge to a stable solution</strong> and it often <strong>finds a local minimum</strong> instead of a global minimum.</p> <p>To improve performance, we can apply several heuristic approaches. For example, we can start with a small codebook \(\{ c_\mathbf{k} \}_{\mathbf{k}=1}^\mathbf{K}\) of \(\mathbf{K}\) elements and optimize it with the EM algorithm. We then split the codebook into two, offset by a small delta \(d\), such that \(\|d\|&lt;\epsilon\) and make the new codebook \(\{ \hat c_\mathbf{k} \}_{\mathbf{k}=1}^{\mathbf{2K}} := \{ c_\mathbf{k},\, c_\mathbf{k}+d \}_{\mathbf{k}=1}^\mathbf{K}\) of \(\mathbf{2K}\) elements.</p> <ul> <li>We then rerun the <code class="language-plaintext highlighter-rouge">EM</code> algorithm on the new codebook. The codebook thus doubles in size at every iteration and we continue until we have the desired codebook size.</li> </ul> <p>The advantage of this approach is that it focuses attention to the big bulk of datapoints \(x_{\mathbf{k}}\), and ignores outliers. The outcome is then expected to be <strong>more stable and the likelihood of converging to a local minimum is smaller.</strong> The downside is that with this approach it is then more <strong>difficult to find small separated islands(=subsets).</strong> That is, because the initial codebook is near the center of the whole mass of datapoints, adding a small delta to the codebook vectors keeps the new codevectors near the center-of-mass.</p> <p>Conversely, we can start with a large codebook, say treat the whole input database \(x_{\mathbf{k}}\) as a codebook. We can then iteratively merge pairs of points which are close to each other, until the codebook is reduced to the desired size. Needless to say, this will be a slow process if the database is large, but will be very efficient in finding separated islands of points.</p> <h4 id="22-optimization-with-machine-learning-platforms">2.2. Optimization with machine learning platforms</h4> <p>A modern approach to modelling is <a href="https://speechprocessingbook.aalto.fi/Modelling/Neural_networks.html" rel="external nofollow noopener" target="_blank">machine learning</a>, where complex phenomena are modelled with neural networks. Typically they are trained with <a href="https://en.wikipedia.org/wiki/Gradient_descent" rel="external nofollow noopener" target="_blank">gradient-descent</a> type methods, where parameters are iteratively nudged towards the minimum, by following the steepest gradient. Since such gradients can be <strong>automatically derived</strong> on machine learning platforms (using the <a href="https://en.wikipedia.org/wiki/Chain_rule" rel="external nofollow noopener" target="_blank">chain rule</a>), they can be applied on very complex models. Consequently, they have become very popular and succesful.</p> <p>The same type of training can be readily applied to vector quantizers as well. However, there is a practical problem with this approach. Estimation of the gradients of the parameters with <strong>the chain-rule</strong> requires that <strong>all intermediate gradients are non-zero</strong>. Quantizers are however piece-wise constant such that their gradients are uniformly zero, thus disabling the chain rule and gradient descent for all parameters which lie behind the quantizer in the computational graph. A practical solution is known as <strong>pass-through</strong>, where gradients are passed unchanged through the quantizer. This approximation is simple to implement and provides often adequate performance.</p> <h3 id="terminology">Terminology</h3> <div align="center"> <img src="/assets/img/vq/vq-overview.png" width="100%"> <p>Fig. 2: Overview of VQ</p> </div> <ul> <li>codebook : vocabulary \(V = \{v_{1}, v_{2}, \cdots, v_{n}\}\) 를 구성하는 symbol들의 set, 연속적인 데이터를 이산 데이터로 mapping 되는 집합이며, 이는 기본적으로 vector를 요소로 가지는 리스트이다.</li> <li>codeword(prototype vector) : codebook 안에 있는 각각의 symbol \(v_{k}\) (e.g., 256개의 codeword를 사용한다면 각각의 vector를 \(0 \sim 255\)로 나타낼 수 있음. 즉, 8-bit 양자화)</li> <li>clustering algorithm : codebook을 만드는 알고리즘. 학습 set 내의 모든 feature vector들을 256개의 class로 clustering한다. 그러고 나서 이 cluster에서 대표적인 feature vector를 고르고, 이것을 그 cluster에 대한 codeword로 삼는다. 주로 K-means clustering이 자주 사용된다.</li> <li>distance metric : codebook을 만들고 나면 각각의 input feature vector들을 256개의 codeword와 비교한다. 이때 distance metric을 이용하여 가장 가까운 codeword 하나를 선택한다.</li> </ul> <h5 id="references">References:</h5> <ul> <li><a href="https://hyunlee103.tistory.com/30" rel="external nofollow noopener" target="_blank">Tistory</a></li> <li><a href="https://machinelearning.wtf/terms/codebook/" rel="external nofollow noopener" target="_blank">Machine Learning Terms</a></li> <li><a href="https://speechprocessingbook.aalto.fi/Modelling/Vector_quantization_VQ.html" rel="external nofollow noopener" target="_blank">speechprocessing</a></li> <li><a href="http://www.mqasem.net/vectorquantization/vq.html" rel="external nofollow noopener" target="_blank">mqasem</a></li> </ul> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/6dof-graspnet/">[paper-review] 6-DOF GraspNet: Variational Grasp Generation for Object Manipulation</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/apriltag-pose-estimation/">[구현] AprilTag Pose Estimation</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/aligndiff/">[paper-review] AlignDiff: Aligning Diverse Human Preferences via Behavior-customisable Diffusion Model</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/prs/">[paper-review] Poisson Reconstruction</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/rbc/">[paper-review] Reactive Base Control for On-The-Move Mobile Manipulation in Dynamic Environments</a> </li> <div id="giscus_thread" style="max-width: 800px; margin: 0 auto;"> <script>let giscusTheme=localStorage.getItem("theme"),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"joonhyung-lee/joonhyung-lee.github.io","data-repo-id":"","data-category":"Comments","data-category-id":"","data-mapping":"title","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Joel Lee. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?4a129fbf39254905f505c7246e641eaf"></script> <script defer src="/assets/js/copy_code.js?7254ae07fe9cc5f3a10843e1c0817c9c" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>